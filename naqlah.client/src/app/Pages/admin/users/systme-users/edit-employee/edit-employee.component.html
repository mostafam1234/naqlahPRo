<div class="min-h-screen bg-neutral-50">
  <div class="container mx-auto max-w-5xl">
    <!-- Page Header -->
    <app-page-header
      [title]="'تعديل بيانات الموظف'"
      [subtitle]="'تحديث معلومات الموظف'"
      [showBackButton]="true"
      iconPath="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
      (onBackClick)="router.navigate(['/admin/users/systemUsers'])"
    >
    </app-page-header>

    <!-- Form Card -->
    <div class="bg-white rounded-xl shadow-sm border border-neutral-200 mt-6">
      <div class="px-6 py-5 border-b border-neutral-200 bg-gradient-to-r from-amber-50 to-amber-100">
        <h2 class="text-xl font-semibold text-neutral-900">معلومات الموظف</h2>
        <p class="text-sm text-neutral-600 mt-1">تحديث بيانات الموظف</p>
      </div>

      <!-- Loading State -->
      <div *ngIf="isLoading && !empForm.get('email')?.value" class="p-12 text-center">
        <div class="inline-block animate-spin rounded-full h-10 w-10 border-4 border-primary-200 border-t-primary-600"></div>
        <p class="mt-4 text-sm font-medium text-neutral-700">جاري التحميل...</p>
      </div>

      <form [formGroup]="empForm" (ngSubmit)="submitForm()" class="p-6" *ngIf="!isLoading || empForm.get('email')?.value">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Full Name -->
          <div class="space-y-2">
            <label for="fullName" class="block text-sm font-medium text-neutral-700">
              الاسم الكامل <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                <svg class="h-5 w-5 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
              </div>
              <input
                id="fullName"
                type="text"
                formControlName="fullName"
                placeholder="أدخل الاسم الكامل"
                class="block w-full pr-10 pl-3 py-2.5 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-200 text-sm"
                [ngClass]="{
                  'border-red-300 focus:ring-red-500 focus:border-red-500': empForm.get('fullName')?.invalid && empForm.get('fullName')?.touched
                }"
              />
            </div>
            <div *ngIf="empForm.get('fullName')?.invalid && empForm.get('fullName')?.touched" class="flex items-center gap-1.5 text-sm text-red-600">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
              </svg>
              <span>الاسم الكامل مطلوب</span>
            </div>
          </div>

          <!-- Email -->
          <div class="space-y-2">
            <label for="email" class="block text-sm font-medium text-neutral-700">
              البريد الإلكتروني <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                <svg class="h-5 w-5 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
              </div>
              <input
                id="email"
                type="email"
                formControlName="email"
                placeholder="example@email.com"
                class="block w-full pr-10 pl-3 py-2.5 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-200 text-sm"
                [ngClass]="{
                  'border-red-300 focus:ring-red-500 focus:border-red-500': empForm.get('email')?.invalid && empForm.get('email')?.touched
                }"
              />
            </div>
            <div *ngIf="empForm.get('email')?.invalid && empForm.get('email')?.touched" class="flex items-center gap-1.5 text-sm text-red-600">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
              </svg>
              <span>البريد الإلكتروني مطلوب وصحيح</span>
            </div>
          </div>

          <!-- Phone Number -->
          <div class="space-y-2">
            <label for="phoneNumber" class="block text-sm font-medium text-neutral-700">
              رقم الهاتف <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                <svg class="h-5 w-5 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                </svg>
              </div>
              <input
                id="phoneNumber"
                type="text"
                formControlName="phoneNumber"
                placeholder="+20 100 000 0000"
                class="block w-full pr-10 pl-3 py-2.5 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-200 text-sm"
                [ngClass]="{
                  'border-red-300 focus:ring-red-500 focus:border-red-500': empForm.get('phoneNumber')?.invalid && empForm.get('phoneNumber')?.touched
                }"
              />
            </div>
            <div *ngIf="empForm.get('phoneNumber')?.invalid && empForm.get('phoneNumber')?.touched" class="flex items-center gap-1.5 text-sm text-red-600">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
              </svg>
              <span>رقم الهاتف مطلوب</span>
            </div>
          </div>

          <!-- New Password -->
          <div class="space-y-2">
            <label for="newPassword" class="block text-sm font-medium text-neutral-700">
              كلمة المرور الجديدة
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                <svg class="h-5 w-5 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                </svg>
              </div>
              <input
                id="newPassword"
                type="password"
                formControlName="newPassword"
                placeholder="اتركه فارغاً إذا لم تريد تغيير كلمة المرور"
                class="block w-full pr-10 pl-3 py-2.5 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-200 text-sm"
              />
            </div>
            <p class="text-xs text-neutral-500">اتركه فارغاً إذا لم تريد تغيير كلمة المرور</p>
          </div>

          <!-- Role -->
          <div class="space-y-2">
            <label for="roleId" class="block text-sm font-medium text-neutral-700">
              الدور <span class="text-red-500">*</span>
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none z-10">
                <svg class="h-5 w-5 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
              </div>
              <select
                id="roleId"
                formControlName="roleId"
                [disabled]="isLoadingRoles"
                class="block w-full pr-10 pl-3 py-2.5 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-200 text-sm appearance-none bg-white"
                [ngClass]="{
                  'border-red-300 focus:ring-red-500 focus:border-red-500': empForm.get('roleId')?.invalid && empForm.get('roleId')?.touched,
                  'bg-neutral-100 cursor-not-allowed': isLoadingRoles
                }"
              >
                <option [value]="null" disabled selected>اختر الدور</option>
                <option *ngFor="let role of roles" [value]="role.id">
                  {{ getRoleDisplayName(role) }}
                </option>
              </select>
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <svg class="h-5 w-5 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </div>
            </div>
            <div *ngIf="isLoadingRoles" class="flex items-center gap-1.5 text-sm text-neutral-500">
              <div class="w-4 h-4 border-2 border-neutral-300 border-t-primary-600 rounded-full animate-spin"></div>
              <span>جاري تحميل الأدوار...</span>
            </div>
            <div *ngIf="empForm.get('roleId')?.invalid && empForm.get('roleId')?.touched && !isLoadingRoles" class="flex items-center gap-1.5 text-sm text-red-600">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
              </svg>
              <span>الدور مطلوب</span>
            </div>
          </div>

          <!-- Status -->
          <div class="space-y-2">
            <label for="isActive" class="block text-sm font-medium text-neutral-700">
              الحالة
            </label>
            <div class="relative">
              <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                <svg class="h-5 w-5 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <select
                id="isActive"
                formControlName="isActive"
                class="block w-full pr-10 pl-3 py-2.5 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-200 text-sm appearance-none bg-white"
              >
                <option [value]="true">نشط</option>
                <option [value]="false">غير نشط</option>
              </select>
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <svg class="h-5 w-5 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </div>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="flex items-center justify-end gap-4 pt-6 mt-6 border-t border-neutral-200">
          <button
            type="button"
            (click)="router.navigate(['/admin/users/systemUsers'])"
            class="px-6 py-2.5 text-sm font-medium text-neutral-700 bg-white border border-neutral-300 rounded-lg hover:bg-neutral-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all duration-200"
          >
            إلغاء
          </button>
          <button
            type="submit"
            [disabled]="empForm.invalid || isLoading"
            class="px-6 py-2.5 text-sm font-semibold text-white bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 rounded-lg shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 inline-flex items-center gap-2"
          >
            <span *ngIf="!isLoading">تحديث البيانات</span>
            <span *ngIf="isLoading" class="inline-flex items-center gap-2">
              <div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
              جاري التحديث...
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
