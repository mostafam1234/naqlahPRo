 <div class="relative">
  <!-- Notification Bell Icon -->
  <button
    (click)="toggleDropdown()"
    class="relative p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-full transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
    [class.text-blue-600]="isOpen"
  >
    <!-- SVG Icon -->
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M12.0201 3.41016C8.71009 3.41016 6.02009 6.10016 6.02009 9.41016V12.3002C6.02009 12.9102 5.76009 13.8402 5.45009 14.3602L4.30009 16.2702C3.59009 17.4502 4.08009 18.7602 5.38009 19.2002C9.69009 20.6402 14.3401 20.6402 18.6501 19.2002C19.8601 18.8002 20.3901 17.3702 19.7301 16.2702L18.5801 14.3602C18.2801 13.8402 18.0201 12.9102 18.0201 12.3002V9.41016C18.0201 6.11016 15.3201 3.41016 12.0201 3.41016Z" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round"/>
      <path d="M13.8699 3.69945C13.5599 3.60945 13.2399 3.53945 12.9099 3.49945C11.9499 3.37945 11.0299 3.44945 10.1699 3.69945C10.4599 2.95945 11.1799 2.43945 12.0199 2.43945C12.8599 2.43945 13.5799 2.95945 13.8699 3.69945Z" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M15.02 19.5605C15.02 21.2105 13.67 22.5605 12.02 22.5605C11.2 22.5605 10.44 22.2205 9.90002 21.6805C9.36002 21.1405 9.02002 20.3805 9.02002 19.5605" stroke="currentColor" stroke-width="1.5" stroke-miterlimit="10"/>
    </svg>

    <!-- Notification Badge -->
    <span
      *ngIf="unreadCountDisplay > 0"
      class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-medium animate-pulse"
    >
      {{ unreadCountDisplay > 9 ? '9+' : unreadCountDisplay }}
    </span>
  </button>

  <!-- Dropdown Menu -->
  <div
    *ngIf="isOpen"
    class="absolute right-0 mt-2 w-80 bg-white rounded-lg shadow-2xl border border-gray-100 z-50 transform transition-all duration-200 ease-out"
    [class.opacity-0]="!isOpen"
    [class.scale-95]="!isOpen"
    [class.opacity-100]="isOpen"
    [class.scale-100]="isOpen"
  >
    <!-- Header -->
    <div class="px-4 py-3 border-b border-gray-100 bg-gray-50 rounded-t-lg">
      <div class="flex items-center justify-between">
        <h3 class="text-lg font-semibold text-gray-800">الإشعارات</h3>
        <div class="flex items-center space-x-2 space-x-reverse">
          <button
            (click)="markAllAsRead()"
            class="text-sm text-blue-600 hover:text-blue-800 font-medium transition-colors duration-150"
          >
            تعيين الكل كمقروء
          </button>
          <span class="text-sm text-gray-500">{{ unreadCountDisplay }} جديد</span>
        </div>
      </div>
    </div>

    <!-- Notifications List -->
    <div class="max-h-96 overflow-y-auto">
      <div *ngIf="notifications.length === 0" class="p-8 text-center">
        <div class="w-16 h-16 mx-auto mb-4 text-gray-300">
          <svg fill="currentColor" viewBox="0 0 20 20">
            <path d="M10 2a8 8 0 100 16 8 8 0 000-16zM8 7a1 1 0 012 0v4a1 1 0 11-2 0V7zm2 8a1 1 0 100-2 1 1 0 000 2z"/>
          </svg>
        </div>
        <p class="text-gray-500 text-sm">لا توجد إشعارات</p>
      </div>

      <div *ngFor="let notification of notifications; trackBy: trackByNotificationId">
        <div
          class="px-4 py-3 hover:bg-gray-50 cursor-pointer transition-colors duration-150 border-b border-gray-50 last:border-b-0"
          [class.bg-blue-50]="!notification.isRead"
          (click)="onNotificationClick(notification)"
        >
          <div class="flex items-start space-x-3 space-x-reverse">
            <!-- Type Icon -->
            <div
              class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center"
              [ngClass]="{
                'bg-blue-100 text-blue-600': getNotificationTypeClass(notification.notificationType) === 'info',
                'bg-green-100 text-green-600': getNotificationTypeClass(notification.notificationType) === 'success',
                'bg-yellow-100 text-yellow-600': getNotificationTypeClass(notification.notificationType) === 'warning',
                'bg-red-100 text-red-600': getNotificationTypeClass(notification.notificationType) === 'error'
              }"
            >
              <!-- Info Icon -->
              <svg *ngIf="getNotificationTypeClass(notification.notificationType) === 'info'" class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
              </svg>

              <!-- Success Icon -->
              <svg *ngIf="getNotificationTypeClass(notification.notificationType) === 'success'" class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>

              <!-- Warning Icon -->
              <svg *ngIf="getNotificationTypeClass(notification.notificationType) === 'warning'" class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
              </svg>

              <!-- Error Icon -->
              <svg *ngIf="getNotificationTypeClass(notification.notificationType) === 'error'" class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
              </svg>
            </div>

            <!-- Notification Content -->
            <div class="flex-1 min-w-0">
              <div class="flex items-center justify-between">
                <h4
                  class="text-sm font-medium text-gray-900 truncate"
                  [class.font-bold]="!notification.isRead"
                >
                  {{ notification.title }}
                </h4>
                <div class="flex items-center space-x-1 space-x-reverse">
                  <span class="text-xs text-gray-500">{{ notification.creationDate | date:'dd/MM/yyyy HH:mm'}}</span>
                  <div
                    *ngIf="!notification.isRead"
                    class="w-2 h-2 bg-blue-600 rounded-full"
                  ></div>
                </div>
              </div>
              <p class="mt-1 text-xs text-gray-600 leading-relaxed">
                {{ notification.message }}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="px-4 py-3 bg-gray-50 border-t border-gray-100 rounded-b-lg">
      <button
        class="w-full text-center text-sm text-blue-600 hover:text-blue-800 font-medium transition-colors duration-150"
        (click)="viewAllNotifications()"
      >
        عرض جميع الإشعارات
      </button>
    </div>
  </div>

  <!-- Backdrop -->
  <div
    *ngIf="isOpen"
    class="fixed inset-0 z-40"
    (click)="closeDropdown()"
  ></div>
</div>
